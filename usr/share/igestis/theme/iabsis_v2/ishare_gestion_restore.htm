<!-- INCLUDE overall_header.htm -->
<h1>{LANG_ISHARE_Gestion_restore_file_description_short}</h1>
<h2>{LANG_ISHARE_Gestion_restore_file_description}</h2>

<link rel="stylesheet" href="{TEMPLATE_URL}/ishare.css" media="screen" type="text/css">
<!-- INCLUDE overall_header2.htm -->

<script type="text/javascript">
show_hide_block('administration_menu');

function p_focused(field)
{
	document.getElementById("p_" + field).className = "p_focused";
}

function p_blur(name)
{
	var p = document.getElementById("p_" + name);
	var span = document.getElementById("span_" + name);
	var field = document.getElementById(name);

	p.className = "";
	
}

function ishare_add_date_list(date_list, folder_list) {
	var list = "";
	document.getElementById('date_list_fieldset').style.display = "block";
	for(i = 0; i < date_list.length; i++) {
		if(i == 2) list += '<label style="width:80px;">&nbsp;</label>';
		list += '<input type="radio" name="date" value="' + folder_list[i] + '"';
		if(folder_list[i] == '{DATE}') list += ' checked="checked"';
		list += ' /> ' + date_list[i] + '<br />';
	}
	document.getElementById('date_list').innerHTML = list;
}

function valid_form() {
	if(document.getElementById('date_list_fieldset').style.display != "block") {
		alert("{LANG_ISHARE_Mount_tape_before_continue}");
		return false;
	}
	
	var radio_list = document.getElementsByName('date');
	var radio_checked = false;
	
	for(i = 0; i < radio_list.length; i++) {
		if(radio_list[i].checked) {
			radio_checked = true;
		}
	}
	
	if(!radio_checked) {
		alert("{LANG_ISHARE_Choose_a_date}");
		return false;
	}
	
	return true;
}

function restore_file(file_name) {
	if(confirm("{LANG_ISHARE_Restore_entities} '" + file_name + "' ?")) {

		messageObj.setHtmlContent('LANG_ISHARE_Wait_during_restore');
		messageObj.setSize(300,150);
		messageObj.setCssClassMessageBox(false);
		messageObj.setSource(false);	// no html source since we want to use a static message here.
		messageObj.setShadowDivVisible(true);	// Disable shadow for these boxes	
		messageObj.display();
		
		xajax_ishare_restore_file('{DATE}', file_name);
		//messageObj.close();
	}
}

function ishare_dl_file(file) {
	window.location.href="{MODULE_FOLDER_URL}dl_file.php?file={DATE}/" + encodeURIComponent(file);
}

function restore_mysql_base(base_name) {
	if(confirm("{LANG_ISHARE_Restore_database} '" + base_name + "' ?")) {
		xajax_ishare_restore_mysql_db(base_name, '{DATE}');
	}
}
</script>

					
<div class="main-content-top-actions">
	<span class="inner">
		<!-- Bloc de liens ajouter and co -->
		<ul class="search-form">
			<form name="user" action="index.php" method="get" class="popup_form" onsubmit="return valid_form()">

			<!-- Champ de formulaire masqués mais qui doivent être transmis à updatedb.php -->
			<input type="hidden" name="Page" value="module" />	
			<input type="hidden" name="module_name" value="iShare" />	
			<input type="hidden" name="rubrique" value="{RUBR_ID}" />
			<input type="hidden" name="folder" value="{FOLDER}" />
			<input type="hidden" name="shared_folder" value="{SHARED_FOLDER}" />

			
			<li id="date_list_fieldset" style="display:none">
				<p id="p_date">
					<label style="width:80px;" for="date">Date</label>
					<span id="date_list"></span>
					<span class="error_message" id="span_date">						
					</span>
				</p>	
			</li>			
			
			<input type="image" src="{TEMPLATE_URL}images/bt_valider.gif" class="img" />
			</form>
		</ul>
		
		<ul class="action_menu">
			<li class="last-row"><span id="mount_button"></span><script type="text/javascript">xajax_ishare_get_tape_status();</script></li>
		</ul>
	</span> 
</div>
<div><br /><br /><br /><br /><br /></div>

<div class="main-content-footer">
	<span class="inner">	
		
		<!-- IF TAPE_MOUNTED -->		
		<fieldset class="left">
		<div class="upperleft">
			<div class="upperright">
				<div class="lowerleft">
					<div class="lowerright">
						<h5>{LANG_ISHARE_Profiles_restore}</h5>
						
						<!-- BEGIN exploration_profils_restore -->
						<a href="index.php?Page=module&module_name=iShare&rubrique={RUBR_ID}&date={DATE}&shared_folder={SHARED_FOLDER}&folder={exploration_profils_restore.folder}">{exploration_profils_restore.folder_name}</a><!-- IF exploration_profils_restore.last_folder --><!-- ELSE --> / <!-- ENDIF -->
						<!-- END exploration_profils_restore -->					
						
						<table class="normal_table" style="margin:20px auto; width:90%">
						<tr>
							<th>{LANG_ISHARE_Profile_name}</th>
							<th style="width:150px">{LANG_Actions}</th>
						</tr>
						<!-- IF DATE -->
						<!-- IF FOLDERS_LIST -->
							<!-- BEGIN FOLDERS_LIST -->
							<tr class="{FOLDERS_LIST.CLASS}">
								<td><img src="{TEMPLATE_URL}images/icones/filetypes/folder_closed.gif" /> 
									<!-- IF FOLDERS_LIST.is_file -->{FOLDERS_LIST.folder_name}
									<!-- ELSE --><a href="index.php?Page=module&module_name=iShare&rubrique={RUBR_ID}&date={DATE}&shared_folder={SHARED_FOLDER}&folder={FOLDERS_LIST.folder}">{FOLDERS_LIST.folder_name}</a><!-- ENDIF -->
								</td>
								<td><a href="javascript:restore_file('{FOLDERS_LIST.folder}')"><img alt="Restore" src="{TEMPLATE_URL}/images/ishare_restore.png" /></a></td>
							</tr>						
							<!-- END FOLDERS_LIST -->
						<!-- ELSE FOLDERS_LIST -->
						<tr><td colspan="2">{LANG_ISHARE_Folder_not_found}</td></tr>
						<!-- ENDIF FOLDERS_LIST-->
						<!-- ELSE DATE -->
						<tr><td colspan="2">{LANG_ISHARE_Choose_a_date}</td></tr>
						<!-- ENDIF DATE -->
						</table>
					</div>
				</div>
			</div>
		</div>		
		</fieldset>	
		
		<fieldset class="right">
		<div class="upperleft">
			<div class="upperright">
				<div class="lowerleft">
					<div class="lowerright">
						<h5>{LANG_ISHARE_File_share_restore}</h5>						
						
						<!-- BEGIN exploration_shared_files_restore -->
						<a href="index.php?Page=module&module_name=iShare&rubrique={RUBR_ID}&date={DATE}&shared_folder={exploration_shared_files_restore.folder}&folder={FOLDER}">{exploration_shared_files_restore.folder_name}</a><!-- IF exploration_shared_files_restore.last_folder --><!-- ELSE --> / <!-- ENDIF -->
						<!-- END exploration_shared_files_restore -->
						
						<table class="normal_table" style="margin:20px auto; width:90%">
						<tr>
							<th>{LANG_ISHARE_File_share_name}</th>
							<th style="width:150px">{LANG_Actions}</th>
						</tr>
						<!-- IF DATE -->
						<!-- IF SHARED_FOLDERS_LIST -->
							<!-- BEGIN SHARED_FOLDERS_LIST -->
							<tr class="{SHARED_FOLDERS_LIST.CLASS}">
								<td><img src="{TEMPLATE_URL}images/icones/filetypes/{SHARED_FOLDERS_LIST.icon}" /> 
									<!-- IF SHARED_FOLDERS_LIST.is_file -->{SHARED_FOLDERS_LIST.folder_name}
									<!-- ELSE --><a href="index.php?Page=module&module_name=iShare&rubrique={RUBR_ID}&date={DATE}&folder={FOLDER}&shared_folder={SHARED_FOLDERS_LIST.folder}">{SHARED_FOLDERS_LIST.folder_name}</a><!-- ENDIF -->
								</td>
								<td><a href="javascript:restore_file('{SHARED_FOLDERS_LIST.folder}')"><img alt="Restore" src="{TEMPLATE_URL}/images/ishare_restore.png" /></a></td>
							</tr>						
							<!-- END SHARED_FOLDERS_LIST -->
						<!-- ELSE SHARED_FOLDERS_LIST -->
						<tr><td colspan="2">{LANG_ISHARE_Folder_not_found}</td></tr>
						<!-- ENDIF SHARED_FOLDERS_LIST-->
						<!-- ELSE DATE -->
						<tr><td colspan="2">{LANG_ISHARE_Choose_a_date}</td></tr>
						<!-- ENDIF DATE -->
						</table>
					</div>
				</div>
			</div>
		</div>		
		</fieldset>	
		<!-- ENDIF TAPE_MOUNTED -->
		
		<hr />
	</span>
</div>
<!-- INCLUDE overall_footer.htm -->