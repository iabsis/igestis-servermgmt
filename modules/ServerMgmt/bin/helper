#!/bin/bash

cwd=$(dirname "${BASH_SOURCE[0]}")

action=${1}
args=${@}

getfacl="/bin/getfacl"
setfacl="/bin/setfacl -m"
rmfacl="/bin/setfacl -x"

getValueConfig()
{

grep "^$1[[:space:]]*=.*" ${cwd}/../config/config.ini | \
  cut -d= -f 2 | \
  cut -d" " -f 2 | \
  sed 's/\"//g'
}

case $action in

  getDataFolderAcl)

    aclList=$(${getfacl} $(getValueConfig DATA_FOLDER_MGMT)/* 2>/dev/null)

    while IFS= read -r line ; do
        echo ${line}
    done <<< "$aclList"

    exit

  ;;

  setDataFolderAcl)

    username=${2}
    folder=${3}
    right=${4}

    case ${right} in
      read)
        ${setfacl} u:${username}:r-x $(getValueConfig DATA_FOLDER_MGMT)/${folder} 2>&1 || exit $?
      ;;
      write)
        ${setfacl} u:${username}:rwx $(getValueConfig DATA_FOLDER_MGMT)/${folder} 2>&1 || exit $?
      ;;
      none)
        ${rmfacl} u:${username} $(getValueConfig DATA_FOLDER_MGMT)/${folder} 2>&1 || exit $?
      ;;
      *)
        echo "Wrong right value, must be read, write or none." || exit 1
      ;;
    esac

  ;;

esac
